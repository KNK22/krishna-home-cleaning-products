<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Your Cart</title>

<style>
body {
  margin: 0;
  font-family: Arial, sans-serif;
  background: #fff;
  color: #000;
}

header {
  position: relative;
  display: flex;
  align-items: center;
  padding: 14px 16px;
  border-bottom: 1px solid #eee;
}

.header-pill {
  padding: 10px 18px;
  border-radius: 999px;
  border: 1px solid #ccc;
  background: #fff;
  font-weight: 600;
  cursor: pointer;
}

header h2 {
  position: absolute;
  left: 50%;
  transform: translateX(-50%);
  margin: 0;
  font-size: 22px;
  font-weight: 700;
}

#cart {
  padding: 16px;
  max-width: 1000px;
  margin: 0 auto;
}

.empty-cart {
  text-align: center;
  color: #666;
  margin: 60px 0;
  font-size: 18px;
}

.cart-item {
  display: grid;
  grid-template-columns: 140px 1fr;
  gap: 20px;
  padding: 16px 0;
  border-bottom: 1px solid #eee;
}

.cart-item img {
  width: 140px;
  height: 140px;
  object-fit: cover;
  border-radius: 12px;
}

.cart-details h4 {
  margin: 0 0 10px;
  font-size: 20px;
  font-weight: 700;
}

.variant-row {
  display: grid;
  grid-template-columns: 1fr auto auto;
  align-items: center;
  gap: 16px;
  padding: 6px 0;
}

.qty-box {
  display: flex;
  align-items: center;
  gap: 6px;
}

.qty-box button {
  width: 30px;
  height: 30px;
  border: 1px solid #aaa;
  border-radius: 6px;
  background: #fff;
  cursor: pointer;
}

.qty-box span {
  min-width: 16px;
  text-align: center;
  font-weight: 600;
}

.variant-price {
  min-width: 80px;
  text-align: right;
  font-weight: 600;
}

.cart-subtotal {
  margin-top: 10px;
  font-weight: 700;
}

#totalBox {
  position: sticky;
  bottom: 0;
  background: #fff;
  padding: 16px;
  border-top: 1px solid #eee;
  max-width: 1000px;
  margin: 0 auto;
}

#total {
  font-size: 20px;
  font-weight: 700;
  margin-bottom: 12px;
}

#orderBtn {
  width: 100%;
  padding: 16px;
  font-size: 18px;
  font-weight: 700;
  background: #22c55e;
  color: #fff;
  border: none;
  border-radius: 12px;
  cursor: pointer;
}

#orderBtn:disabled {
  background: #bdbdbd;
  cursor: not-allowed;
}
</style>
</head>

<body>

<header style="flex-direction:column; align-items:center; gap:4px;">
  <button class="header-pill" style="position:absolute; left:16px;" onclick="history.back()">‚Üê Back</button>

  <h2 style="position:static; transform:none; margin:0;">
    Your Cart
  </h2>

  <div style="font-size:16px; color:#2e7d32; font-weight:600;">
    Free delivery in Visakhapatnam
  </div>

  <div style="font-size:15px; color:#777;">
    (Limited time only)
  </div>
</header>



<div id="cart"></div>

<div id="totalBox">
  <div id="total">Total: ‚Çπ0</div>
  <button id="orderBtn">Place Order</button>
</div>

<script>
let cart = JSON.parse(localStorage.getItem("cart")) || [];

/* ================= GROUP CART ================= */
function groupCart() {
  const grouped = {};

  cart.forEach(item => {

    if (item.type === "combo") {
      grouped[item.id] = {
        isCombo: true,
        id: item.id,
        name: item.name,
        image: item.image,
        price: item.price,
        qty: item.qty,
        items: item.items
      };
      return;
    }

    if (!grouped[item.product]) {
      grouped[item.product] = {
        isCombo: false,
        product: item.product,
        image: item.image,
        items: []
      };
    }

    grouped[item.product].items.push(item);
  });

  return Object.values(grouped);
}

/* ================= RENDER CART ================= */
function renderCart() {
  const cartBox = document.getElementById("cart");
  const totalEl = document.getElementById("total");
  const orderBtn = document.getElementById("orderBtn");

  cartBox.innerHTML = "";

  if (cart.length === 0) {
    cartBox.innerHTML = `
      <div class="empty-cart">
        üõí <br><br>
        <strong>Your cart is empty.</strong><br>
        Add products to continue.
      </div>
    `;
    totalEl.innerText = "Total: ‚Çπ0";
    orderBtn.disabled = true;
    return;
  }

  orderBtn.disabled = false;

  let groups = groupCart();
  let grandTotal = 0;

  groups.forEach(group => {

    /* ===== COMBO RENDER (ALIGNED WITH OTHERS) ===== */
    if (group.isCombo) {
      const subtotal = group.price * group.qty;
      grandTotal += subtotal;

      cartBox.innerHTML += `
        <div class="cart-item">
          <img src="${group.image}">
          <div class="cart-details">
            <h4>${group.name}</h4>

            <div class="variant-row">
              <div>
                <ul style="margin:8px 0 0; padding-left:18px;">
                  ${group.items.map(i => `<li>${i}</li>`).join("")}
                </ul>
              </div>

              <div class="qty-box">
                <button onclick="updateComboQty('${group.id}', -1)">‚àí</button>
                <span>${group.qty}</span>
                <button onclick="updateComboQty('${group.id}', 1)">+</button>
              </div>

              <div class="variant-price">‚Çπ${subtotal}</div>
            </div>

          </div>
        </div>
      `;
      return;
    }

    /* ===== NORMAL PRODUCTS (UNCHANGED) ===== */
    let productTotal = 0;

    const rows = group.items.map((item, i) => {
      const subtotal = item.qty * item.price;
      productTotal += subtotal;
      grandTotal += subtotal;

      return `
        <div class="variant-row">
          <div>${item.variant}${item.flavour ? ` (${item.flavour})` : ""}</div>

          <div class="qty-box">
            <button onclick="updateQty('${group.product}', ${i}, -1)">‚àí</button>
            <span>${item.qty}</span>
            <button onclick="updateQty('${group.product}', ${i}, 1)">+</button>
          </div>

          <div class="variant-price">‚Çπ${subtotal}</div>
        </div>
      `;
    }).join("");

    cartBox.innerHTML += `
      <div class="cart-item">
        <img src="${group.image}">
        <div class="cart-details">
          <h4>${group.product}</h4>
          ${rows}
          <div class="cart-subtotal">Subtotal: ‚Çπ${productTotal}</div>
        </div>
      </div>
    `;
  });

  totalEl.innerText = "Total: ‚Çπ" + grandTotal;
}

/* ================= NORMAL QTY ================= */
function updateQty(product, index, change) {
  const groups = groupCart();
  const group = groups.find(g => g.product === product);
  if (!group) return;

  const item = group.items[index];
  if (!item) return;

  item.qty += change;
  cart = cart.filter(i => i.qty > 0);

  localStorage.setItem("cart", JSON.stringify(cart));
  renderCart();
}

/* ================= COMBO QTY ================= */
function updateComboQty(id, change) {
  cart = cart.map(i => {
    if (i.type === "combo" && i.id === id) {
      i.qty += change;
    }
    return i;
  }).filter(i => i.qty > 0);

  localStorage.setItem("cart", JSON.stringify(cart));
  renderCart();
}

/* ================= ORDER ================= */
document.getElementById("orderBtn").onclick = () => {
  let msg = "Order Details\n\n";

  groupCart().forEach(g => {
    if (g.isCombo) {
      msg += g.name + " (Combo)\n";
      g.items.forEach(i => msg += `‚Ä¢ ${i}\n`);
      msg += `Qty: ${g.qty}\n\n`;
    } else {
      msg += g.product + "\n";
      g.items.forEach(i => {
        msg += `‚Ä¢ ${i.variant}${i.flavour ? ` (${i.flavour})` : ""} √ó ${i.qty}\n`;
      });
      msg += "\n";
    }
  });

  window.open(
    "https://wa.me/917093187617?text=" + encodeURIComponent(msg),
    "_blank"
  );
};

renderCart();
</script>

<footer style="
  text-align:center;
  padding:16px 12px;
  font-size:25px;
  color:#555;
  border-top:1px solid #eee;
  margin-top:40px;
">
  REPACKED &amp; MARKETED BY KRISHNA
</footer>

</body>
</html>
