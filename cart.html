<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Your Cart</title>

<style>
body {
  margin: 0;
  font-family: Arial, sans-serif;
  background: #fff;
  color: #000;
}

/* ===== HEADER ===== */

header {
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: 4px;
  padding: 14px 16px;
  border-bottom: 1px solid #eee;
  position: relative;
}

.header-pill {
  padding: 10px 18px;
  border-radius: 999px;
  border: 1px solid #ccc;
  background: #fff;
  font-weight: 600;
  cursor: pointer;
  position: absolute;
  left: 16px;
  top: 14px;
}

header h2 {
  margin: 0;
  font-size: 22px;
  font-weight: 700;
}

/* ===== CART ===== */

#cart {
  padding: 16px;
  max-width: 1000px;
  margin: 0 auto;
}

.empty-cart {
  text-align: center;
  color: #666;
  margin: 60px 0;
  font-size: 18px;
}

/* ===== PRODUCT GROUP ===== */

.cart-group {
  border: 1px solid #ddd;
  border-radius: 16px;
  padding: 16px;
  margin-bottom: 20px;
}

.cart-group h3 {
  margin: 0 0 14px;
  font-size: 20px;
  font-weight: 700;
}

.cart-row {
  display: grid;
  grid-template-columns: 90px 1fr auto auto;
  align-items: center;
  gap: 14px;
  padding: 10px 0;
}

/* üî• BIGGER IMAGE FOR ALL ITEMS */
.cart-row img {
  width: 100px;
  height: 100px;
  object-fit: cover;
  border-radius: 12px;
  background: #f2f2f2;
}

.qty-box {
  display: flex;
  align-items: center;
  gap: 6px;
}

.qty-box button {
  width: 28px;
  height: 28px;
  border: 1px solid #aaa;
  border-radius: 6px;
  background: #fff;
  cursor: pointer;
}

.qty-box span {
  min-width: 16px;
  text-align: center;
  font-weight: 600;
}

.price {
  font-weight: 600;
  min-width: 80px;
  text-align: right;
}

.group-subtotal {
  margin-top: 12px;
  display: flex;
  justify-content: flex-end;
  font-weight: 700;
}

/* ===== TOTAL ALIGN ===== */

#totalRow {
  display: flex;
  justify-content: flex-end;
}

#total {
  width: 140px;
  text-align: right;
  font-size: 20px;
  font-weight: 700;
  margin-bottom: 12px;
}

/* ===== TOTAL BOX ===== */

#totalBox {
  position: sticky;
  bottom: 0;
  background: #fff;
  padding: 16px;
  border-top: 1px solid #eee;
  max-width: 1000px;
  margin: 0 auto;
}

#orderBtn {
  width: 100%;
  padding: 16px;
  font-size: 18px;
  font-weight: 700;
  background: #22c55e;
  color: #fff;
  border: none;
  border-radius: 12px;
  cursor: pointer;
}

#orderBtn:disabled {
  background: #bdbdbd;
  cursor: not-allowed;
}
</style>
</head>

<body>

<header>
  <button class="header-pill" onclick="history.back()">‚Üê Back</button>

  <h2>Your Cart</h2>

  <div style="font-size:16px; color:#2e7d32; font-weight:600;">
    Free delivery in Visakhapatnam
  </div>

  <div style="font-size:15px; color:#777;">
    (Limited time only)
  </div>
</header>

<div id="cart"></div>

<div id="totalBox">
  <div id="totalRow">
    <div id="total">Total: ‚Çπ0</div>
  </div>
  <button id="orderBtn">Place Order</button>
</div>

<script>
let cart = JSON.parse(localStorage.getItem("cart")) || [];

/* ===== IMAGE FOR NORMAL PRODUCTS ===== */
function getCartImage(item) {
  const folder = item.product.toLowerCase().replaceAll(" ", "-");
  const v = item.variant.toLowerCase().replace(" ", "");
  const f = item.flavour ? "-" + item.flavour.toLowerCase() : "";
  return `./images/${folder}/${v}${f}.jpg`;
}

function renderCart() {
  const cartBox = document.getElementById("cart");
  const totalEl = document.getElementById("total");
  const orderBtn = document.getElementById("orderBtn");

  cartBox.innerHTML = "";

  if (cart.length === 0) {
    cartBox.innerHTML = `
      <div class="empty-cart">
        üõí <br><br>
        <strong>Your cart is empty.</strong>
      </div>
    `;
    totalEl.innerText = "Total: ‚Çπ0";
    orderBtn.disabled = true;
    return;
  }

  orderBtn.disabled = false;
  let grandTotal = 0;

  /* ===== COMBOS ===== */
  cart.filter(i => i.type === "combo").forEach(combo => {
    const subtotal = combo.qty * combo.price;
    grandTotal += subtotal;

    cartBox.innerHTML += `
      <div class="cart-group">
        <div class="cart-row">
          <img src="${combo.image}">
          <div>
            <strong>${combo.name}</strong>
            <ul style="margin:8px 0 0; padding-left:18px;">
              ${combo.items.map(i => `<li>${i}</li>`).join("")}
            </ul>
          </div>

          <div class="qty-box">
            <button onclick="updateComboQty('${combo.id}', -1)">‚àí</button>
            <span>${combo.qty}</span>
            <button onclick="updateComboQty('${combo.id}', 1)">+</button>
          </div>

          <div class="price">‚Çπ${subtotal}</div>
        </div>
      </div>
    `;
  });

  /* ===== NORMAL PRODUCTS ===== */
  const grouped = {};
  cart.filter(i => !i.type).forEach(item => {
    if (!grouped[item.product]) grouped[item.product] = [];
    grouped[item.product].push(item);
  });

  Object.keys(grouped).forEach(product => {
    let productTotal = 0;

    const rows = grouped[product].map((item, i) => {
      const sub = item.qty * item.price;
      productTotal += sub;
      grandTotal += sub;

      return `
        <div class="cart-row">
          <img src="${getCartImage(item)}">
          <div>${item.variant}${item.flavour ? ` (${item.flavour})` : ""}</div>

          <div class="qty-box">
            <button onclick="updateQty('${product}', ${i}, -1)">‚àí</button>
            <span>${item.qty}</span>
            <button onclick="updateQty('${product}', ${i}, 1)">+</button>
          </div>

          <div class="price">‚Çπ${sub}</div>
        </div>
      `;
    }).join("");

    cartBox.innerHTML += `
      <div class="cart-group">
        <h3>${product}</h3>
        ${rows}
        <div class="group-subtotal">Subtotal: ‚Çπ${productTotal}</div>
      </div>
    `;
  });

  totalEl.innerText = "Total: ‚Çπ" + grandTotal;
}

/* ===== UPDATE NORMAL ===== */
function updateQty(product, index, change) {
  const items = cart.filter(i => i.product === product);
  const item = items[index];
  if (!item) return;

  item.qty += change;
  cart = cart.filter(i => i.qty > 0);

  localStorage.setItem("cart", JSON.stringify(cart));
  renderCart();
}

/* ===== UPDATE COMBO ===== */
function updateComboQty(id, change) {
  cart = cart.map(i => {
    if (i.type === "combo" && i.id === id) {
      i.qty += change;
    }
    return i;
  }).filter(i => i.qty > 0);

  localStorage.setItem("cart", JSON.stringify(cart));
  renderCart();
}

/* ===== ORDER ===== */
document.getElementById("orderBtn").onclick = () => {
  let msg = "Order Details\n\n";

  cart.forEach(i => {
    if (i.type === "combo") {
      msg += `${i.name} (Combo) √ó ${i.qty}\n`;
      i.items.forEach(x => msg += `‚Ä¢ ${x}\n`);
      msg += "\n";
    } else {
      msg += `${i.product} - ${i.variant}${i.flavour ? ` (${i.flavour})` : ""} √ó ${i.qty}\n`;
    }
  });

  window.open(
    "https://wa.me/917093187617?text=" + encodeURIComponent(msg),
    "_blank"
  );
};

renderCart();
</script>

<footer style="
  text-align:center;
  padding:16px 12px;
  font-size:25px;
  color:#555;
  border-top:1px solid #eee;
  margin-top:40px;
">
  REPACKED &amp; MARKETED BY KRISHNA
</footer>

</body>
</html>
