<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Product</title>

<meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
<meta name="theme-color" content="#2e7d32">

<link rel="manifest" href="manifest.json">
<link rel="stylesheet" href="style.css">
</head>

<body>

<div style="position:fixed; top:14px; left:14px; z-index:20;">
  <button class="header-pill back-btn" onclick="history.back()">‚Üê Back</button>
</div>

<div style="position:fixed; top:14px; right:14px; z-index:20;">
  <div id="cartBox" class="header-pill cart-btn" onclick="location.href='cart.html'">
    üõí Cart (0)
  </div>
</div>

<div class="container">

  <div class="product-layout">

    <div class="product-left">
      <div id="image" class="main-image"></div>
    </div>

    <div class="product-right">
      <h2 id="name"></h2>
      <div id="price">Select variant</div>

      <h4>Select Variant</h4>
      <div id="variants" class="options"></div>

      <!-- FLAVOURS (HIDDEN INITIALLY) -->
      <div id="flavourSection" style="display:none;">
        <h4>Select Flavour</h4>
        <div id="flavours" class="options"></div>
      </div>

      <h4>Quantity</h4>
      <div class="qty-box">
        <button class="qty-btn" onclick="changeQty(-1)">‚àí</button>
        <span id="qty">1</span>
        <button class="qty-btn" onclick="changeQty(1)">+</button>
      </div>

      <button id="addBtn" class="add-btn">
        Select Variant & Flavour
      </button>
    </div>
  </div>

  <div class="info-section">
    <h3>Description</h3>
    <p id="description"></p>

    <h3>How to Use</h3>
    <p id="howToUse"></p>
  </div>

</div>

<script src="data.js"></script>

<script>
function getCart(){
  return JSON.parse(localStorage.getItem("cart")) || [];
}

function updateCart(){
  const cart = getCart();
  let count = 0;
  cart.forEach(i => count += Number(i.qty) || 0);
  document.getElementById("cartBox").innerText = "üõí Cart (" + count + ")";
}

const id = new URLSearchParams(location.search).get("id");
const product = PRODUCTS[id];

document.getElementById("name").innerText = product.name;
document.getElementById("image").style.backgroundImage =
  `url('./images/${product.imageFolder}/cover.jpg')`;

document.getElementById("description").innerText = product.description;
document.getElementById("howToUse").innerText = product.howToUse;

let variant = null;
let flavour = "";
let qty = 1;

const priceDiv = document.getElementById("price");
const addBtn = document.getElementById("addBtn");
const flavourSection = document.getElementById("flavourSection");

/* üîπ IMAGE SWITCHING */
function updateImage() {
  let img = "cover.jpg";

  if (variant) {
    const v = variant.toLowerCase().replace(/\s+/g, "");
    img = v + ".jpg";
  }

  if (variant && flavour) {
    const v = variant.toLowerCase().replace(/\s+/g, "");
const f = flavour.toLowerCase().trim(); // trim() removes spaces at the start/end
    img = `${v}-${f}.jpg`;
  }

  document.getElementById("image").style.backgroundImage =
    `url('./images/${product.imageFolder}/${img}')`;
}

/* ================= VARIANTS ================= */

Object.keys(product.variants).forEach(v => {
  const o = document.createElement("div");
  o.className = "option";
  o.innerText = v;

  o.onclick = () => {
    document.querySelectorAll("#variants .option")
      .forEach(x => x.classList.remove("active"));
    o.classList.add("active");

    variant = v;
    flavour = "";

    flavourSection.style.display = "block";
    document.querySelectorAll("#flavours .option")
      .forEach(x => x.classList.remove("active"));

    updateImage();
    updatePrice();
    checkReady();
  };

  variants.appendChild(o);
});

/* ================= FLAVOURS ================= */

if(product.flavours.length === 0){
  flavourSection.style.display = "none";
}

product.flavours.forEach(f => {
  const o = document.createElement("div");
  o.className = "option";
  o.innerText = f;

  o.onclick = () => {
    document.querySelectorAll("#flavours .option")
      .forEach(x => x.classList.remove("active"));
    o.classList.add("active");

    flavour = f;
    updateImage();
    checkReady();
  };

  flavours.appendChild(o);
});

/* ================= PRICE & QTY ================= */

function updatePrice(){
  const p = product.variants[variant];
  priceDiv.innerHTML =
    `<span class="mrp">‚Çπ${p.mrp}</span>
     ‚Çπ${p.price} √ó ${qty} = <b>‚Çπ${p.price * qty}</b>`;
}

function changeQty(v){
  qty = Math.max(1, qty + v);
  document.getElementById("qty").innerText = qty;
  if(variant) updatePrice();
}

/* ================= ADD TO CART ================= */

function resetSelections(){
  variant = null;
  flavour = "";
  qty = 1;

  document.getElementById("qty").innerText = "1";
  priceDiv.innerText = "Select variant";
  flavourSection.style.display = "none";

  document.querySelectorAll(".option")
    .forEach(x => x.classList.remove("active"));

  document.getElementById("image").style.backgroundImage =
    `url('./images/${product.imageFolder}/cover.jpg')`;

  addBtn.classList.remove("active");
  addBtn.innerText = "Select Variant & Flavour";
}

function checkReady(){
  if(variant && (product.flavours.length === 0 || flavour)){
    addBtn.classList.add("active");
    addBtn.innerText = "ADD TO CART";

    addBtn.onclick = () => {
      const cart = getCart();
      const existing = cart.find(i =>
        i.product === product.name &&
        i.variant === variant &&
        i.flavour === flavour
      );

      if(existing) existing.qty += qty;
      else cart.push({
        product: product.name,
        variant,
        flavour,
        price: product.variants[variant].price,
        qty,
        image: `./images/${product.imageFolder}/cover.jpg`
      });

      localStorage.setItem("cart", JSON.stringify(cart));
updateCart();

/* ===== BUTTON FEEDBACK (SAME AS OFFERS) ===== */
const originalText = addBtn.innerText;

addBtn.innerText = "‚úì Added";
addBtn.style.background = "#16a34a";
addBtn.style.transform = "scale(1.05)";
addBtn.style.transition = "transform 0.15s ease, background 0.15s ease";

setTimeout(() => {
  addBtn.style.transform = "scale(1)";
}, 150);

setTimeout(() => {
  addBtn.innerText = originalText;
  addBtn.style.background = "";
  resetSelections();
}, 900);
    };
  }
}

updateCart();
</script>

</body>
</html>
